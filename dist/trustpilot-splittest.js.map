{"version":3,"file":"trustpilot-splittest.js","sources":["../src/cookiehelper.ts","../src/useragenthelper.ts","../src/usersession.ts","../src/rng.ts","../src/tracking.ts","../src/utils.ts","../src/splittest.ts","../src/main.ts"],"sourcesContent":["export default class CookieHelper {\r\n\r\n    static createCookie(name: string, value: string, days: number): void {\r\n        var expires = \"\";\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            expires = \"; expires=\" + date.toUTCString();\r\n        }\r\n        document.cookie = name + \"=\" + value + expires + \"; path=/\";            \r\n    }\r\n\r\n    static readCookie(name: string): string | null {\r\n        var nameEq = name + \"=\";\r\n        var ca = document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) === ' ') {\r\n                c = c.substring(1, c.length); \r\n            }\r\n            if (c.indexOf(nameEq) === 0) {\r\n                return c.substring(nameEq.length, c.length);\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static eraseCookie(name: string) {\r\n        CookieHelper.createCookie(name, \"\", -1);\r\n    }\r\n}","import $ from \"jquery\";\r\n\r\nexport interface UserAgentInfo {\r\n    name: string;\r\n    version: string;\r\n    isMobile: boolean;\r\n}\r\n\r\nexport class UserAgentHelper {\r\n\r\n    private static isMobile() {\r\n        var ua = navigator.userAgent || navigator.vendor;\r\n        return /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ua)\r\n            || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(ua.substr(0, 4));\r\n    }\r\n\r\n    private static getNameAndVersion() {\r\n        var ua = navigator.userAgent,\r\n            tem: RegExpMatchArray | null,\r\n            match : RegExpMatchArray = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\r\n        if (/trident/i.test(match[1])) {\r\n            tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\r\n            return {\r\n                name: 'IE',\r\n                version: (tem[1] || '')\r\n            };\r\n        }\r\n        if (match[1] === 'Chrome') {\r\n            tem = ua.match(/\\bOPR\\/(\\d+)/);\r\n            if (tem != null) {\r\n                return {\r\n                    name: 'Opera',\r\n                    version: tem[1]\r\n                };\r\n            }\r\n        }\r\n        match = match[2] ? [match[1], match[2]] : [navigator.appName, navigator.appVersion, '-?'];\r\n        if ((tem = ua.match(/version\\/(\\d+)/i)) != null) {\r\n            match.splice(1, 1, tem[1]);\r\n        }\r\n        return {\r\n            name: match[0],\r\n            version: match[1]\r\n        };\r\n    }\r\n\r\n    static getUserAgentInfo() : UserAgentInfo {\r\n        return $.extend(UserAgentHelper.getNameAndVersion(), {\r\n            isMobile: UserAgentHelper.isMobile()\r\n        });\r\n    }\r\n}","import {UserAgentInfo, UserAgentHelper} from \"./useragenthelper\";\r\nimport CookieHelper from \"./cookiehelper\";\r\n\r\nconst userSessionDaysToLive = 3;\r\n\r\nexport interface TestVariantsMap {\r\n    [key: string]: string; \r\n}\r\n\r\nexport default class UserSession {\r\n    readonly userAgent: UserAgentInfo;\r\n\r\n    constructor(\r\n        private daysToLive: number,\r\n        public testSegment: number = Math.floor((Math.random() * 100) + 1),\r\n        private testVariants : TestVariantsMap = {}\r\n    ) {\r\n        this.userAgent = UserAgentHelper.getUserAgentInfo();\r\n    }\r\n\r\n    setTestVariant(testName: string, variantName: string): void {\r\n        this.testVariants[testName] = variantName;\r\n    }\r\n\r\n    getTestVariant(testName: string): string {\r\n        return this.testVariants[testName];\r\n    }\r\n\r\n    save(key: string): void {\r\n        var json = JSON.stringify({\r\n            testSegment: this.testSegment,\r\n            testVariants: this.testVariants\r\n        });\r\n        CookieHelper.createCookie(key, json, this.daysToLive);\r\n    }\r\n\r\n    static fromJson(json: string): UserSession {\r\n        var obj = JSON.parse(json);\r\n        return new UserSession(userSessionDaysToLive, obj.testSegment, obj.testVariants);\r\n    }\r\n}","/**\r\n * Linear Congruential Generator\r\n * https://en.wikipedia.org/wiki/Linear_congruential_generator\r\n */\r\nexport default class Rng {\r\n    // Using GCC's constants\r\n    static readonly m = 0x80000000; // 2**31;\r\n    static readonly a = 1103515245;\r\n    static readonly c = 12345;\r\n\r\n    private state: number;\r\n\r\n    constructor(seed: number) {\r\n        this.state = seed;\r\n    }\r\n\r\n    nextInt() {\r\n        this.state = (Rng.a * this.state + Rng.c) % Rng.m;\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * Get a (integer) number in range [start, end): including start, excluding end.\r\n     * @param start Range start (included)\r\n     * @param end Range end (excluded)\r\n     */\r\n    nextRange(start: number, end: number) {\r\n        // can't modulu nextInt because of weak randomness in lower bits\r\n        const rangeSize = end - start;\r\n        const randomUnder1 = this.nextInt() / Rng.m;\r\n        return start + Math.floor(randomUnder1 * rangeSize);\r\n    }\r\n}","export let trackingEventHandler: TrackingEventHandler;\r\n\r\nexport interface ObjectLiteral {\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface TrackingData extends ObjectLiteral { }\r\n\r\n/**\r\n * Describing a handler for A/B test events\r\n */\r\nexport interface TrackingEventHandler {\r\n    /**\r\n     * Records an action your user performs.\r\n     * @param event The name of the event youâ€™re tracking.\r\n     * @param trackingData A dictionary of properties for the event\r\n     */\r\n    track(event: TrackEventType, trackingData: TrackingData): void;\r\n\r\n    /**\r\n     * A helper method that attaches the track call as a handler to a link\r\n     * @param elements DOM element to be bound with track method\r\n     * @param event The name of the event, passed to the track method\r\n     * @param trackingData A dictionary of properties to pass with the track method. \r\n     */\r\n    trackLink(elements: Element | JQuery, event: TrackEventType, trackingData: TrackingData): void;\r\n}\r\n\r\n/**\r\n * A function that extends a tracking data object with even more data\r\n */\r\nexport interface TrackingDataExtender {\r\n    (trackingData: TrackingData, event: string): TrackingData;\r\n}\r\n\r\nexport declare type TrackEventType = \"ExperimentViewed\" | \"ExperimentActionPerformed\";\r\nexport declare type TrackEventActionType = \"Click\";\r\n\r\n/**\r\n * Constructs a new TrackingDataExtender that extending the existing tracking data with the provided tracking data\r\n * @param newTrackingData\r\n */\r\nexport function trackingDataExtenderFactory(newTrackingData: TrackingData): TrackingDataExtender {\r\n    return (trackingData: TrackingData) => $.extend(trackingData, newTrackingData);\r\n}\r\n\r\nexport function setTrackingEventHandler(handler: TrackingEventHandler): void {\r\n    if (typeof handler === \"object\" && typeof handler.track === \"function\" && typeof handler.trackLink === \"function\") {\r\n        trackingEventHandler = handler;\r\n    }\r\n}","\r\nexport interface QueryString extends Array<string> {\r\n    [key: string]: any;\r\n}\r\n\r\nexport function parseQueryString<T extends QueryString>(queryString?: string): T {\r\n    queryString = queryString || location.search;\r\n    const parameters = queryString.replace(/^\\?/, \"\").split('&');\r\n    const vars: QueryString = [];\r\n\r\n    for (let i = 0; i < parameters.length && parameters[i] !== \"\"; i++) {\r\n        const [key, value] = parameters[i].split('=');\r\n        vars.push(key);\r\n        vars[key] = decodeURIComponent(value);\r\n    }\r\n    return <T>vars;\r\n}","import { UserAgentInfo } from \"./useragenthelper\";\r\nimport UserSession from \"./UserSession\";\r\nimport Rng from \"./rng\";\r\nimport { TrackingDataExtender, trackingDataExtenderFactory, TrackingData, TrackEventType, TrackEventActionType, trackingEventHandler } from \"./tracking\";\r\nimport { parseQueryString } from \"./utils\";\r\n\r\nexport interface Variant {\r\n    /** A descriptive unique name of this variant */\r\n    name: string;\r\n    /** The percentage of users who should see this variant */\r\n    segment: number;\r\n    /** Function to be called when this variant has been chosen and should be setup. It's always called after DOMContentLoaded */\r\n    setup?: (this: AbTest, userAgentInfo: UserAgentInfo) => void;\r\n    /** Whether a track event should automatically be published once this variant has been setup. Default is true. */\r\n    trackEventAutoPublish?: boolean;\r\n}\r\n\r\nexport interface ConditionFunction {\r\n    (userAgentInfo: UserAgentInfo): boolean;\r\n}\r\n\r\nexport class AbTest {\r\n \r\n    //private trackingDataExtender: TrackingDataExtender = baseTrackingDataExtenderFactory();\r\n    private condition: ConditionFunction;\r\n    readonly variants: Variant[] = [];\r\n\r\n    constructor(public name: string, private trackingDataExtender: TrackingDataExtender) {\r\n        this.extendTrackingData(trackingDataExtenderFactory({\r\n            \"experimentName\": name\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Determines whether this test is able to run or not.\r\n     */\r\n    public canRun(userAgentInfo: UserAgentInfo): boolean {\r\n        return typeof this.condition !== \"function\" || this.condition(userAgentInfo);\r\n    }\r\n\r\n    public setCondition(condition: ConditionFunction): AbTest {\r\n        this.condition = condition;\r\n        return this;\r\n    }\r\n\r\n    addVariant(variant: Variant): AbTest {\r\n        if (typeof variant.name !== \"string\" || variant.name === \"\" || this.getVariant(variant.name)) {\r\n            throw new Error(`A/B Test \"${this.name}\": Variant must have a unique name. Was \"${variant.name}\"`);\r\n        }\r\n        if (typeof variant.segment !== \"number\" || variant.segment < 0 || variant.segment > 100) {\r\n            throw new Error(`A/B Test \"${this.name}\", variant \"${variant.name}\": \"segment\" must be a number between 0-100. Was ${variant.segment}`);\r\n        }\r\n        this.variants.push(variant);\r\n        return this;\r\n    }\r\n\r\n    setup(userSession: UserSession): boolean {\r\n        // Step 1: Validate whether this test is correctly configured\r\n        const variantsSegmentationSum = Math.round(this.variants.reduce((sum, v) => sum + v.segment, 0));\r\n        if (variantsSegmentationSum !== 100) {\r\n            console.error(`A/B Test: IGNORING test \"${this.name}\", because variant segmentation does not add up to 100. Current value: ${variantsSegmentationSum}`);\r\n            return false;\r\n        }\r\n\r\n        // Step 2: Run condition function, if any\r\n        if (typeof this.condition === \"function\" && !this.condition(userSession.userAgent)) {\r\n            return false;\r\n        }\r\n\r\n        // Step 3: Select and setup variant\r\n        const variant = this.selectVariant(userSession);\r\n        userSession.setTestVariant(this.name, variant.name);\r\n        this.extendTrackingData(trackingDataExtenderFactory({\r\n            \"variationName\": variant.name\r\n        }));\r\n        if (typeof variant.setup === \"function\") {\r\n            variant.setup.call(this, userSession.userAgent, this);\r\n        }\r\n        \r\n        // Step 4: Publish track event\r\n        if (variant.trackEventAutoPublish !== false) {\r\n            this.trackViewed();\r\n        }\r\n        return true;\r\n    }\r\n\r\n    getVariant(name: string): Variant {\r\n        return this.variants.filter((v) => v.name === name)[0];\r\n    }\r\n\r\n    getVariantUrl(variantName: string | null): string {\r\n        const param = `${this.name}=${variantName}`,\r\n            query = parseQueryString(location.search);\r\n        try {\r\n            query[\"abtest\"] = btoa(param);\r\n            return location.protocol + \"//\" + location.host + location.pathname +\r\n                \"?\" + $.param(query) +\r\n                location.hash;\r\n        } catch (e) {\r\n            return location.href;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The tracking data extenders are called just before any event is published to the event handler.\r\n     */\r\n    extendTrackingData(trackingDataExtender: TrackingDataExtender): AbTest {\r\n        if (typeof trackingDataExtender === \"function\") {\r\n            let currentExtender = this.trackingDataExtender;\r\n            this.trackingDataExtender = function(trackingData: TrackingData, eventName: string) {\r\n                return trackingDataExtender(currentExtender(trackingData, eventName), eventName);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    private trackEvent(event: TrackEventType, trackingData?: TrackingData): void {\r\n        if (trackingEventHandler) {\r\n            const allTrackingData = this.trackingDataExtender(trackingData || {}, event);\r\n            trackingEventHandler.track(event, allTrackingData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Emits an \"Experiment Viewed\" tracking event \r\n     */\r\n    trackViewed(): void {\r\n        this.trackEvent(\"ExperimentViewed\");\r\n    }\r\n\r\n    /**\r\n     * Emits an \"Experiment Action Performed\" tracking event \r\n     * @param action Specifies the action type that has been performed\r\n     * @param target Specifies a target the action has affected or originated from\r\n     */\r\n    trackActionPerformed(action: TrackEventActionType, target?: string): void {\r\n        this.trackEvent(\"ExperimentActionPerformed\", {\r\n            \"action\": action,\r\n            \"actionTarget\": (target || \"\")\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Attaches a <code>trackActionPerformed</code> call as a handler to a link.\r\n     * @param elements The DOM element to be bound with track method.\r\n     * @param name A human readable name of the link. If left out, the innerText of the element is used\r\n     */\r\n    trackLink(elements: Element | JQuery, name?: string): void {\r\n        if (trackingEventHandler) {\r\n            const event: TrackEventType = \"ExperimentActionPerformed\";\r\n            const trackingData = this.trackingDataExtender({\r\n                \"action\": \"Click\",\r\n                \"actionTarget\": name || $(elements).text()\r\n            }, event);\r\n            trackingEventHandler.trackLink(elements, event, trackingData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Selects a variation based on a user session.\r\n     * If the user has already seen a specific variation, we select the same one again\r\n     */\r\n    private selectVariant(userSession: UserSession): Variant {\r\n        let selectedVariant = this.getVariant(userSession.getTestVariant(this.name) || \"\");\r\n        \r\n        if (!selectedVariant) { // Select a new variation\r\n            let testSegment = this.getTestSegment(userSession.testSegment);\r\n            for (let i = 0, variantLowerBound = 0; i < this.variants.length; i++) {\r\n                let variant = this.variants[i],\r\n                    variantUpperBound = variantLowerBound + this.variants[i].segment;\r\n                if (variantLowerBound < testSegment && testSegment <= variantUpperBound) {\r\n                    selectedVariant = variant;\r\n                    break;\r\n                }\r\n                variantLowerBound = variantUpperBound;\r\n            }\r\n        }\r\n        return selectedVariant;\r\n    }\r\n\r\n    /**\r\n     * Rotates the user segment number using the name of this test.\r\n     * @param userTestSegment The segment number chosen for this user (1-100)\r\n     * @returns {number} A number between 1-100 \r\n     */\r\n    private getTestSegment(userTestSegment: number): number {\r\n        const seed = this.name.split(\"\")\r\n                                .map(c => c.charCodeAt(0))\r\n                                .reduce((a, b) => a + (b * userTestSegment), 0);\r\n        const rng = new Rng(seed);\r\n        return rng.nextRange(1,101);\r\n    }\r\n} ","import $ from \"jquery\";\r\nimport { UserAgentHelper, UserAgentInfo } from \"./useragenthelper\";\r\nimport CookieHelper from \"./cookiehelper\";\r\nimport UserSession from \"./usersession\";\r\nimport { AbTest, ConditionFunction } from \"./splittest\";\r\nimport {TrackingDataExtender, TrackingEventHandler, trackingDataExtenderFactory } from \"./tracking\";\r\nimport { parseQueryString } from \"./utils\";\r\n\r\nexport let tests: AbTest[] = [];\r\nconst cookieName = \"trustpilotABTest\",\r\n        userSessionDaysToLive = 3;\r\nlet isInitialized = false,\r\n    userSession: UserSession,\r\n    globalCondition: ConditionFunction;\r\n\r\n\r\nexport interface ObjectLiteral {\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * The base tracking data extender supplying general tracking data\r\n */\r\nfunction baseTrackingDataExtenderFactory(): TrackingDataExtender { \r\n    return trackingDataExtenderFactory({\r\n        \"browser\": userSession.userAgent.name,\r\n        \"browserVersion\": userSession.userAgent.version,\r\n        \"isMobile\": userSession.userAgent.isMobile\r\n    });\r\n} \r\n\r\nfunction getOrCreateUserSession(): UserSession {\r\n    const existingSession = CookieHelper.readCookie(cookieName);\r\n    return existingSession != null\r\n        ? UserSession.fromJson(existingSession)\r\n        : new UserSession(userSessionDaysToLive);\r\n}\r\n\r\n\r\nfunction initializeFromQueryString(userSession: UserSession): void {\r\n    const query = parseQueryString(location.search),\r\n            abtestParam = query[\"abtest\"];\r\n    \r\n    if (typeof abtestParam === \"string\") {\r\n        try {\r\n            let testAndVariant = atob(abtestParam).split(\"=\"),\r\n                test = testAndVariant[0],\r\n                variant = testAndVariant[1];\r\n            userSession.setTestVariant(test, variant);\r\n        } catch (e) { }\r\n    }\r\n}\r\n\r\n(function initialize(): void {\r\n    userSession = getOrCreateUserSession();\r\n\r\n    // On DOMContentLoaded\r\n    $(() => {\r\n        if (typeof globalCondition !== \"function\" || globalCondition(userSession.userAgent)) {\r\n            initializeFromQueryString(userSession);\r\n\r\n            $(window).on(\"pagehide\", () => {\r\n                if (tests.length > 0) {\r\n                    userSession.save(cookieName);\r\n                }\r\n            });\r\n\r\n            tests = tests.filter((test) => {\r\n                return test.setup(userSession);\r\n            });\r\n        }\r\n        isInitialized = true;\r\n    });\r\n})();\r\n\r\n\r\n// Public API \r\n\r\nfunction validateInitialized() {\r\n    if (!isInitialized) {\r\n        throw new Error(\"A/B Test: Not ready yet! (wait for DOMContentLoaded)\");\r\n    }\r\n}\r\nfunction validateTestName(testName: string) {\r\n    if (!getTest(testName)) {\r\n        throw new Error(`A/B Test: Unknown test \"${testName}\"`);\r\n    }\r\n}\r\n\r\nfunction reloadWithoutAbTestParameter() {\r\n    const query = parseQueryString(location.search);\r\n    delete query[\"abtest\"];\r\n    location.href = location.href.replace(location.search, \"\").replace(location.hash, \"\") +\r\n                        (Object.keys(query).length? \"?\" : \"\") +\r\n                        $.param(query) +\r\n                        location.hash;\r\n}\r\n\r\nexport function getUserAgentInfo(): UserAgentInfo {\r\n    return userSession.userAgent;\r\n}\r\n\r\nexport function getTest(name: string) {\r\n    return tests.filter(t => t.name === name)[0];\r\n}\r\n\r\nexport function canRunTest(test: AbTest): boolean {\r\n    return (typeof globalCondition !== \"function\" || globalCondition(userSession.userAgent)) &&\r\n            test.canRun(userSession.userAgent);\r\n}\r\n\r\nexport function create(name: string) : AbTest {\r\n    const test = new AbTest(name, baseTrackingDataExtenderFactory());\r\n    if (isInitialized) {\r\n        if (globalCondition(userSession.userAgent)) {\r\n            // Setup \"immediately\" in the next cycle of the event loop.\r\n            // This will allow a condition and test variations to be added on beforehand.\r\n            setTimeout(function() {\r\n                if (test.setup(userSession)) {\r\n                    tests.push(test);\r\n                }\r\n            });\r\n        }\r\n    } else {\r\n        tests.push(test);\r\n    }\r\n    return test;\r\n}\r\n\r\nexport function getTestVariant(testName: string): string {\r\n    validateInitialized();\r\n    validateTestName(testName);\r\n    return userSession.getTestVariant(testName);\r\n}\r\n\r\nexport function hasTestVariant(testName: string, variant: string): boolean {\r\n    if (!isInitialized) {\r\n        console.warn(`A/B Test: Not yet initialized`);\r\n    }\r\n    return isInitialized && userSession.getTestVariant(testName) === variant && getTest(testName) != null;\r\n}\r\n\r\nexport function setTestVariant(testName: string, variant: string): void {\r\n    validateInitialized();\r\n    validateTestName(testName);\r\n    userSession.setTestVariant(testName, variant);\r\n    reloadWithoutAbTestParameter();\r\n}\r\n\r\n/** Set a global condition that must return true before initializing any tests */\r\nexport function setGlobalCondition(condition: ConditionFunction): void {\r\n    if (isInitialized) {\r\n        throw new Error(`A/B Test: Too late. Tests already running`);\r\n    }\r\n    globalCondition = condition;\r\n}\r\n\r\nexport function reset(): void {\r\n    userSession = new UserSession(userSessionDaysToLive);\r\n    reloadWithoutAbTestParameter();\r\n}\r\n\r\nexport namespace ui {\r\n    const uiClass = \"abtest-ui-container\";\r\n    let condition : ConditionFunction = () => { return false; }\r\n    let isInitialized = false;\r\n\r\n    function showAbTestUi(test: AbTest) {\r\n        const variant = getTestVariant(test.name);\r\n        const $abTestContainer = $(`<div class=\"${uiClass} hideme\"></div>`)\r\n                                    .appendTo('body')\r\n                                    .append(`<div class=\"abtest-header\">A/B test. Viewing <span class=\"abtest-variant\">${variant}</span></div>`);\r\n        const data: ObjectLiteral = {\r\n            \"Test\": test.name,\r\n            \"Variation\": `${variant} (${test.getVariant(variant).segment}%)`,\r\n            \"A/B test segment\": userSession.testSegment,\r\n            \"Browser\": userSession.userAgent.name + \" \" +  userSession.userAgent.version,\r\n            \"Mobile device\": userSession.userAgent.isMobile\r\n        };\r\n        Object.keys(data).forEach((key) => {\r\n            $abTestContainer.append(`<div><span class=\"abtest-data-label\">${key}</span><span class=\"abtest-data-value\">${data[key]}</span></div>`);\r\n        });\r\n\r\n        const variantHtml = test.variants.map((variant) => {\r\n            return `<a href=\"${test.getVariantUrl(variant.name)}\" title=\"Segment: ${variant.segment}%\">${variant.name}</a>`;\r\n        });\r\n        $(variantHtml.join(\"&nbsp;&bull;&nbsp;\")).appendTo($abTestContainer);\r\n\r\n        $(`<br><button type=\"button\">Reset all</button>`)\r\n            .on(\"click\", reset)\r\n            .appendTo($abTestContainer);\r\n\r\n        $('<div class=\"abtest-close\">X</div>')\r\n            .on(\"click\", hide)\r\n            .appendTo($abTestContainer);\r\n        \r\n        // Make UI fadein\r\n        $abTestContainer.removeClass('hideme');\r\n        isInitialized = true;\r\n    }\r\n\r\n    $(() => {\r\n        if (!condition(userSession.userAgent)) {\r\n            return;\r\n        }\r\n\r\n        setTimeout(show, 1000);\r\n    });\r\n\r\n    // Public API\r\n    export function setCondition(newCondition: ConditionFunction) {\r\n        condition = newCondition;\r\n    }\r\n\r\n    export function show() {\r\n        if (isInitialized) {\r\n            $(`.${uiClass}`).removeClass('hideme');\r\n        } else if (tests.length > 0) {\r\n            showAbTestUi(tests[0]);\r\n        }\r\n    }\r\n\r\n    export function hide() {\r\n        $(`.${uiClass}`).addClass('hideme');\r\n    }\r\n}"],"names":["$","userSessionDaysToLive","tests","ui"],"mappings":"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"}